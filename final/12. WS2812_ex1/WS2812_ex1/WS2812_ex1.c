/*
 * WS2812.c
 *
 * Created: 2025-11-24 오후 12:49:44
 * Author : jbhma
 */ 
#include <avr/io.h>
#define F_CPU 16000000L
#include <util/delay.h>
#define WC0 PORTC=0
#define WC1 PORTC=1

unsigned char c8x8[192]; // 8x8 픽셀 * 3색상(GRB) = 192 바이트
unsigned char ascii8x8[128][8] = {
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},   // 0x20(space)
   {0x00, 0x00, 0x06, 0x5f, 0x5f, 0x06, 0x00, 0x00},   // 0x21(!)
   {0x00, 0x03, 0x03, 0x00, 0x03, 0x03, 0x00, 0x00},   // 0x22(")
   {0x14, 0x7f, 0x7f, 0x14, 0x7f, 0x7f, 0x14, 0x00},   // 0x23(#)
   {0x24, 0x2e, 0x6b, 0x6b, 0x3a, 0x12, 0x00, 0x00},   // 0x24($)
   {0x46, 0x66, 0x30, 0x18, 0x0c, 0x66, 0x62, 0x00},   // 0x25(%)
   {0x30, 0x7a, 0x4f, 0x5d, 0x37, 0x7a, 0x48, 0x00},   // 0x26(&)
   {0x04, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00},   // 0x27(')
   {0x00, 0x1c, 0x3e, 0x63, 0x41, 0x00, 0x00, 0x00},   // 0x28(()
   {0x00, 0x41, 0x63, 0x3e, 0x1c, 0x00, 0x00, 0x00},   // 0x29())
   {0x08, 0x2a, 0x3e, 0x1c, 0x1c, 0x3e, 0x2a, 0x08},   // 0x2A(*)
   {0x08, 0x08, 0x3e, 0x3e, 0x08, 0x08, 0x00, 0x00},   // 0x2B(+)
   {0x00, 0x80, 0xe0, 0x60, 0x00, 0x00, 0x00, 0x00},   // 0x2C(,)
   {0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00},   // 0x2D(-)
   {0x00, 0x00, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00},   // 0x2E(.)
   {0x60, 0x30, 0x18, 0x0c, 0x06, 0x03, 0x01, 0x00},   // 0x2F(/)
   {0x3e, 0x7f, 0x71, 0x59, 0x4d, 0x7f, 0x3e, 0x00},   // 0x30(0)
   {0x40, 0x42, 0x7f, 0x7f, 0x40, 0x40, 0x00, 0x00},   // 0x31(1)
   {0x62, 0x73, 0x59, 0x49, 0x6f, 0x66, 0x00, 0x00},   // 0x32(2)
   {0x22, 0x63, 0x49, 0x49, 0x7f, 0x36, 0x00, 0x00},   // 0x33(3)
   {0x18, 0x1c, 0x16, 0x53, 0x7f, 0x7f, 0x50, 0x00},   // 0x34(4)
   {0x27, 0x67, 0x45, 0x45, 0x7d, 0x39, 0x00, 0x00},   // 0x35(5)
   {0x3c, 0x7e, 0x4b, 0x49, 0x79, 0x30, 0x00, 0x00},   // 0x36(6)
   {0x03, 0x03, 0x71, 0x79, 0x0f, 0x07, 0x00, 0x00},   // 0x37(7)
   {0x36, 0x7f, 0x49, 0x49, 0x7f, 0x36, 0x00, 0x00},   // 0x38(8)
   {0x06, 0x4f, 0x49, 0x69, 0x3f, 0x1e, 0x00, 0x00},   // 0x39(9)
   {0x00, 0x00, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00},   // 0x3A(:)
   {0x00, 0x80, 0xe6, 0x66, 0x00, 0x00, 0x00, 0x00},   // 0x3B(;)
   {0x08, 0x1c, 0x36, 0x63, 0x41, 0x00, 0x00, 0x00},   // 0x3C(<)
   {0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x00, 0x00},   // 0x3D(=)
   {0x00, 0x41, 0x63, 0x36, 0x1c, 0x08, 0x00, 0x00},   // 0x3E(>)
   {0x02, 0x03, 0x51, 0x59, 0x0f, 0x06, 0x00, 0x00},   // 0x3F(?)
   {0x3e, 0x7f, 0x41, 0x5d, 0x5d, 0x1f, 0x1e, 0x00},   // 0x40(@)
   {0x7c, 0x7e, 0x13, 0x13, 0x7e, 0x7c, 0x00, 0x00},   // 0x41(A)
   {0x41, 0x7f, 0x7f, 0x49, 0x49, 0x7f, 0x36, 0x00},   // 0x42(B)
   {0x1c, 0x3e, 0x63, 0x41, 0x41, 0x63, 0x22, 0x00},   // 0x43(C)
   {0x41, 0x7f, 0x7f, 0x41, 0x63, 0x3e, 0x1c, 0x00},   // 0x44(D)
   {0x41, 0x7f, 0x7f, 0x49, 0x5d, 0x41, 0x63, 0x00},   // 0x45(E)
   {0x41, 0x7f, 0x7f, 0x49, 0x1d, 0x01, 0x03, 0x00},   // 0x46(F)
   {0x1c, 0x3e, 0x63, 0x41, 0x51, 0x73, 0x72, 0x00},   // 0x47(G)
   {0x7f, 0x7f, 0x08, 0x08, 0x7f, 0x7f, 0x00, 0x00},   // 0x48(H)
   {0x00, 0x41, 0x7f, 0x7f, 0x41, 0x00, 0x00, 0x00},   // 0x49(I)
   {0x30, 0x70, 0x40, 0x41, 0x7f, 0x3f, 0x01, 0x00},   // 0x4A(J)
   {0x41, 0x7f, 0x7f, 0x08, 0x1c, 0x77, 0x63, 0x00},   // 0x4B(K)
   {0x41, 0x7f, 0x7f, 0x41, 0x40, 0x60, 0x70, 0x00},   // 0x4C(L)
   {0x7f, 0x7f, 0x0e, 0x1c, 0x0e, 0x7f, 0x7f, 0x00},   // 0x4D(M)
   {0x7f, 0x7f, 0x06, 0x0c, 0x18, 0x7f, 0x7f, 0x00},   // 0x4E(N)
   {0x1c, 0x3e, 0x63, 0x41, 0x63, 0x3e, 0x1c, 0x00},   // 0x4F(O)
   {0x41, 0x7f, 0x7f, 0x49, 0x09, 0x0f, 0x06, 0x00},   // 0x50(P)
   {0x1e, 0x3f, 0x21, 0x71, 0x7f, 0x5e, 0x00, 0x00},   // 0x51(Q)
   {0x41, 0x7f, 0x7f, 0x09, 0x19, 0x7f, 0x66, 0x00},   // 0x52(R)
   {0x26, 0x6f, 0x4d, 0x59, 0x73, 0x32, 0x00, 0x00},   // 0x53(S)
   {0x03, 0x41, 0x7f, 0x7f, 0x41, 0x03, 0x00, 0x00},   // 0x54(T)
   {0x7f, 0x7f, 0x40, 0x40, 0x7f, 0x7f, 0x00, 0x00},   // 0x55(U)
   {0x1f, 0x3f, 0x60, 0x60, 0x3f, 0x1f, 0x00, 0x00},   // 0x56(V)
   {0x7f, 0x7f, 0x30, 0x18, 0x30, 0x7f, 0x7f, 0x00},   // 0x57(W)
   {0x43, 0x67, 0x3c, 0x18, 0x3c, 0x67, 0x43, 0x00},   // 0x58(X)
   {0x07, 0x4f, 0x78, 0x78, 0x4f, 0x07, 0x00, 0x00},   // 0x59(Y)
   {0x47, 0x63, 0x71, 0x59, 0x4d, 0x67, 0x73, 0x00},   // 0x5A(Z)
   {0x00, 0x7f, 0x7f, 0x41, 0x41, 0x00, 0x00, 0x00},   // 0x5B([)
   {0x01, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x00},   // 0x5C(\)
   {0x00, 0x41, 0x41, 0x7f, 0x7f, 0x00, 0x00, 0x00},   // 0x5D(])
   {0x08, 0x0c, 0x06, 0x03, 0x06, 0x0c, 0x08, 0x00},   // 0x5E(^)
   {0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80},   // 0x5F(_)
   {0x00, 0x00, 0x03, 0x07, 0x04, 0x00, 0x00, 0x00},   // 0x60(`)
   {0x20, 0x74, 0x54, 0x54, 0x3c, 0x78, 0x40, 0x00},   // 0x61(a)
   {0x41, 0x7f, 0x3f, 0x48, 0x48, 0x78, 0x30, 0x00},   // 0x62(b)
   {0x38, 0x7c, 0x44, 0x44, 0x6c, 0x28, 0x00, 0x00},   // 0x63(c)
   {0x30, 0x78, 0x48, 0x49, 0x3f, 0x7f, 0x40, 0x00},   // 0x64(d)
   {0x38, 0x7c, 0x54, 0x54, 0x5c, 0x18, 0x00, 0x00},   // 0x65(e)
   {0x48, 0x7e, 0x7f, 0x49, 0x03, 0x02, 0x00, 0x00},   // 0x66(f)
   {0x98, 0xbc, 0xa4, 0xa4, 0xf8, 0x7c, 0x04, 0x00},   // 0x67(g)
   {0x41, 0x7f, 0x7f, 0x08, 0x04, 0x7c, 0x78, 0x00},   // 0x68(h)
   {0x00, 0x44, 0x7d, 0x7d, 0x40, 0x00, 0x00, 0x00},   // 0x69(i)
   {0x60, 0xe0, 0x80, 0x80, 0xfd, 0x7d, 0x00, 0x00},   // 0x6A(j)
   {0x41, 0x7f, 0x7f, 0x10, 0x38, 0x6c, 0x44, 0x00},   // 0x6B(k)
   {0x00, 0x41, 0x7f, 0x7f, 0x40, 0x00, 0x00, 0x00},   // 0x6C(l)
   {0x7c, 0x7c, 0x18, 0x38, 0x1c, 0x7c, 0x78, 0x00},   // 0x6D(m)
   {0x7c, 0x7c, 0x04, 0x04, 0x7c, 0x78, 0x00, 0x00},   // 0x6E(n)
   {0x38, 0x7c, 0x44, 0x44, 0x7c, 0x38, 0x00, 0x00},   // 0x6F(o)
   {0x84, 0xfc, 0xf8, 0xa4, 0x24, 0x3c, 0x18, 0x00},   // 0x70(p)
   {0x18, 0x3c, 0x24, 0xa4, 0xf8, 0xfc, 0x84, 0x00},   // 0x71(q)
   {0x44, 0x7c, 0x78, 0x4c, 0x04, 0x1c, 0x18, 0x00},   // 0x72(r)
   {0x48, 0x5c, 0x54, 0x54, 0x74, 0x24, 0x00, 0x00},   // 0x73(s)
   {0x00, 0x04, 0x3e, 0x7f, 0x44, 0x24, 0x00, 0x00},   // 0x74(t)
   {0x3c, 0x7c, 0x40, 0x40, 0x3c, 0x7c, 0x40, 0x00},   // 0x75(u)
   {0x1c, 0x3c, 0x60, 0x60, 0x3c, 0x1c, 0x00, 0x00},   // 0x76(v)
   {0x3c, 0x7c, 0x70, 0x38, 0x70, 0x7c, 0x3c, 0x00},   // 0x77(w)
   {0x44, 0x6c, 0x38, 0x10, 0x38, 0x6c, 0x44, 0x00},   // 0x78(x)
   {0x9c, 0xbc, 0xa0, 0xa0, 0xfc, 0x7c, 0x00, 0x00},   // 0x79(y)
   {0x4c, 0x64, 0x74, 0x5c, 0x4c, 0x64, 0x00, 0x00},   // 0x7A(z)
   {0x08, 0x08, 0x3e, 0x77, 0x41, 0x41, 0x00, 0x00},   // 0x7B({)
   {0x00, 0x00, 0x00, 0x77, 0x77, 0x00, 0x00, 0x00},   // 0x7C(|)
   {0x41, 0x41, 0x77, 0x3e, 0x08, 0x08, 0x00, 0x00},   // 0x7D(})
   {0x02, 0x03, 0x01, 0x03, 0x02, 0x03, 0x01, 0x00},   // 0x7E(~)
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}   // 0x7F
};

void ascii2c(unsigned char iascii)
{
   unsigned char *pa, *pc;
   unsigned char i, r, g, b;
   pa = ascii8x8[iascii];
   pc = c8x8;
   r = 0x0f; g = 0x0f; b = 0x0f; // 밝기 조정 (너무 밝지 않게 설정)

   for(i=0; i<8; i++)
   {
      // 각 비트를 검사하여 색상 데이터(GRB) 채우기
      if(*pa & 0x01) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x02) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x04) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x08) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x10) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x20) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa & 0x40) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
      if(*pa++ & 0x80) {*pc++ = g; *pc++ = r; *pc++ = b;} else {*pc++ = 0; *pc++ = 0; *pc++ = 0;}
   }
}
void T1(void) // H:0.85us L:0.45us 1.25us+_600ns 20+_9 instructions
{
   WC1;
   _delay_us(0.8); // 0.85
   WC0;
   _delay_us(0.3); // 0.4
}

void T0(void) // H0.4us L:0.85us
{
   WC1;
   _delay_us(0.3);
   WC0;
   _delay_us(0.8);
}

void TL(void) // Transmit Latch command L:50us
{
   WC0;
   _delay_us(60);
}

void TByte(unsigned char b) // MSB -> LSB
{
   if(b & 0x80) T1(); else T0();
   if(b & 0x40) T1(); else T0();
   if(b & 0x20) T1(); else T0();
   if(b & 0x10) T1(); else T0();
   if(b & 0x08) T1(); else T0();
   if(b & 0x04) T1(); else T0();
   if(b & 0x02) T1(); else T0();
   if(b & 0x01) T1(); else T0();
}
void disp_c(void)
{
   unsigned char i, *p;
   p = c8x8;
   for(i=0; i<192; i++)
   {
      TByte(*p++); // TByte 함수는 이전 단계에서 정의됨
   }
}

void test_dispc(void)
{
   unsigned char i;
   for(i=0x21; i<128; i++) // ASCII 문자 순회
   {
      TL(); // Reset 신호
      ascii2c(i); // 폰트 데이터를 LED 데이터로 변환
      disp_c();   // LED로 데이터 전송
      _delay_ms(1000);
   }
}

int main(void)
{
   DDRC = 0xff; // 포트 C 출력 설정
   while(1)
   {
      test_dispc();
   }
}

